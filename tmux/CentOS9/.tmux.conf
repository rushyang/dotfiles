# tmux configuration file

# Default Termial and colors
set-option -g default-terminal "tmux-256color"
set-option -sa terminal-features ',tmux-256color:RGB'

# Refresh interval for clock
set-option -g status-interval 1

# Pane border format
set -g pane-border-format "#{window_index}.#{pane_index}----#{pane_title}----"
set-option -g pane-active-border-style fg=colour250 #fg2
set-option -g pane-border-style fg=colour237 #bg1

# Show window layout conditionally - only when multiple panes are in single window
set-hook -g window-layout-changed 'set-window -F pane-border-status "#{?#{==:#{window_panes},1},off,top}"'

# Prefix + y adds a new entry in clipboard of host OS
set -g @plugin 'tmux-plugins/tmux-yank'
set-option -g -s set-clipboard
set -g @yank_selection 'clipboard'

# Need better mouse support
set-option -g mouse on
setw -g mode-keys vi
# Disable mouse right click
unbind -n MouseDown3Pane
# Changing below value from off to on to experiment sharing with host os clipboard
set-option -s set-clipboard "on"
#bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "xclip -se c -i"
set -g @scroll-speed-num-lines-per-scroll "8"
set -g focus-events on

# Change Text highlight color
set -g mode-style "fg=colour006,bg=colour237"
set -g repeat-time 1000
# Unbind default shift+backspace
unbind ^H
# Set mode-keys to vi instead of emacs
set-window-option -g mode-keys vi
bind-key -T copy-mode-vi 'v' send -X begin-selection
bind-key -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "xclip -sel c" " -i -f -selection primary | xclip -i -selection clipboard"

# Start windows and panes at 1, not 0
set -g base-index 1
setw -g pane-base-index 1

# # Tmux-Gruvbox - dark - medium - Custom theme
set-option -g status "on"

# default statusbar color
set-option -g status-style bg=colour233,fg=colour223 # bg=bg1, fg=fg1

# # default window title colors
set-window-option -g window-status-style bg=colour223,fg=colour237 # bg=yellow, fg=bg1
set-window-option -g window-status-separator ""
# Left
# set-option -g status-left-length "80"
# set-option -g status-left "#[bg=colour148,fg=colour148]#[bg=colour148,fg=colour234]#S:#I.#P#[bg=colour233,fg=colour148,nobold,noitalics,nounderscore]"
set-window-option -g window-status-current-format "#[bg=colour214,fg=colour234,nobold,noitalics,nounderscore]#[bg=colour214,fg=colour232] #I#F #[bg=colour214,fg=colour232,bold] #W#{?window_zoomed_flag,*Z,} #[bg=colour232,fg=colour214,nobold,noitalics,nounderscore]"
set-window-option -g window-status-format "#[bg=colour239,fg=colour234,noitalics]#[bg=colour239,fg=colour223,bold] #I#F#[bg=colour239,fg=colour223,bold] #W #[bg=colour234,fg=colour239,noitalics]"

# End of Gruvbox

# Changing bind key for tmux
unbind C-b
set-option -g prefix C-a
bind-key C-a send-prefix

# Custom Binds
# Single key set
bind & confirm kill-window
unbind a
bind a command-prompt "select-pane -T %%"
unbind b
bind-key b command-prompt -p "send pane to (bottom):"  "join-pane -v -t '%%'"
unbind e
bind-key e copy-mode
unbind V
bind-key V run-shell "tmux copy-mode; tmux send-keys -X begin-selection"
unbind \'
bind-key \' last-window
unbind g
unbind i
bind-key i command-prompt -p "Create new session:" "new-session -d -s '%1' -c '#{pane_current_path}'; switch-client -t '%1'; source ~/.tmux.conf"
# switch panes using h j k l after prefix - or default is ; for last pane
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R
bind K confirm kill-session
unbind m
bind-key m send-keys "aws ssm start-session --target "
bind-key M split-window -h "source ~/.zshrc; nvim ~/.tmux.conf"
bind-key N new-window "source ~/.zshrc; ranger ~/.config/nvim/lua"
unbind q
bind r  move-window -r
bind-key R source-file ~/.tmux.conf \; display-message "~/.tmux.conf reloaded"
unbind o
unbind O
bind-key O send-keys "restartproxy" Enter "amplogin" Enter Enter
# bind-key O send-keys "amplogin" Enter
unbind P
bind-key P send-keys "ranger" Enter
unbind t
bind-key t command-prompt -p "send pane to (top):"  "join-pane -vb -t '%%'"
unbind T
bind T send-keys "kustomize build --load-restrictor LoadRestrictionsNone . | less -RI"
unbind s
bind s choose-session
unbind S
bind-key S command-prompt -p 'save history to filename:' -I '/work/' 'capture-pane -S -32768 ; save-buffer %1; delete-buffer'
bind-key u command-prompt -p "send pane to (right):"  "join-pane -h -t '%%'"
bind-key -T copy-mode-vi 'v' send -X begin-selection
bind-key v paste-buffer
unbind w # By default <prefix> e is bound to choose-window
bind-key w choose-window
bind x confirm kill-pane

# Ctrl-Prefix set
unbind C-b
bind-key C-b send-keys "awsexport Prod" Enter
unbind C-d
bind-key C-d send-keys "awsexport Dev" Enter
unbind C-e
bind-key C-e set-window-option synchronize-panes\; display-message "synchronize-panes is now #{?pane_synchronized,on,off}"
unbind C-m
bind-key C-m send-keys "rssh "
unbind C-q
bind-key C-q send-keys "awsprofile" Enter
unbind C-u
bind-key C-u send-keys "cd ..; ls -lrtA" Enter
unbind C-s
bind-key C-s send-keys "cd; sudo -i" Enter "clear" Enter
unbind C-v
bind-key C-v send-keys "tail -fF /var/log/cfn-init-cmd.log" Enter
unbind C-w
bind-key C-w send-keys "kubectl get events --watch --sort-by='.metadata.creationTimestamp'" Enter
unbind C-z
bind-key C-z split-window -h "nvim ~/.zshrc"
# Alt+Prefix set
unbind M-d
unbind M-e
bind-key M-e send-keys "getec2 | grep -i "
unbind M-f
bind-key M-f new-window "nvim `fzf`"
unbind M-j
bind-key M-j send-keys "kubens" Enter
unbind M-k
bind-key M-k send-keys "customkubectxns" Enter
unbind M-n
bind-key M-n new-window "source ~/.zshrc; nvim"
unbind M-g
bind-key M-g send-keys "glwatch" Enter
unbind M-p
bind-key M-p run-shell "tmux new-window 'ranger #{pane_current_path}'"
unbind M-z
bind-key M-z send-keys "source ~/.zshrc" Enter

# split panes using | and -
unbind -
unbind '"'
unbind %
bind | split-window -h -c '#{pane_current_path}'
bind _ split-window -v -c '#{pane_current_path}'
bind c new-window -c '#{pane_current_path}'

# Remove tmux and vim delay
set -sg escape-time 0

# Resize Panes
# -r makes resize without repeating prefix.
unbind C-H
unbind C-L
unbind C-J
unbind C-K
bind-key -r C-H resize-pane -L 3
bind-key -r C-L resize-pane -R 3
bind-key -r C-J resize-pane -D 1
bind-key -r C-K resize-pane -U 1

# Display message for 1sec only!
set -g display-time 1000

set -g history-limit 250000 #boost history

set -g @plugin 'tmux-plugins/tpm'
# set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'nhdaly/tmux-better-mouse-mode'

# Powerline plugin
set -g @plugin 'erikw/tmux-powerline'
TMUX_POWERLINE_THEME=my-theme

# Plugin to save and restore tmux session
# Reference: https://andrewjamesjohnson.com/restoring-tmux-sessions/
# List of plugins
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @resurrect-save 'M-s'
set -g @resurrect-restore 'M-r'
# In case if I like continuous saving - which currently I really do not.
# set -g @plugin 'tmux-plugins/tmux-continuum'
# set -g @continuum-restore 'on'

# Don't rename windows automatically
set-option -g automatic-rename off
set-option -g allow-rename off

# KEEP THIS LINE AT THE VERY BOTTOM OF TMUX.CONF
# Initialize TMUX plugin manager
run -b '~/.tmux/plugins/tpm/tpm'
